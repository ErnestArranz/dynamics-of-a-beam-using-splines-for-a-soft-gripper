clear
close all
clc
% Time span for the simulation

tspan = [0 6]; 

% Initial conditions:
% [ x1, x2, y2, x3, y3, x4, y4, vx1, vx2, vy2, vx3, vy3, vx4, vy4 ]
L = 1;
X0 = [L/4, L/2, 0, 3*L/4, 0, L, 0, 0, 0, 0, 0, 0, 0, 0];


% Solve the ODE system using ode45
[t, X] = ode45(@myStateSpace, tspan, X0);

% 1. Plot positions (x1, x2, y2, x3, y3, x4, y4)
subplot(2, 2, 1);
plot(t, X(:,1), 'b-', t, X(:,2), 'b--', t, X(:,3), 'r-', t, X(:,4), 'g-', t, X(:,5), 'g--', t, X(:,6), 'm-', t, X(:,7), 'm--');
xlabel('Time');
ylabel('Position');
title('Positions');
legend('x1', 'x2', 'y2', 'x3', 'y3', 'x4', 'y4');
grid on;

% 2. Plot velocities (vx1, vx2, vy2, vx3, vy3, vx4, vy4)
subplot(2, 2, 2);
plot(t, X(:,8), 'b-', t, X(:,9), 'b--', t, X(:,10), 'r-', t, X(:,11), 'g-', t, X(:,12), 'g--', t, X(:,13), 'm-', t, X(:,14), 'm--');
xlabel('Time');
ylabel('Velocity');
title('Velocities');
legend('vx1', 'vx2', 'vy2', 'vx3', 'vy3', 'vx4', 'vy4');
grid on;

% 3. Plot trajectories (x1 vs y1, x2 vs y2, x3 vs y3, x4 vs y4)
subplot(2, 2, 3);
plot(X(:,1), zeros(length(X),1), 'b-', X(:,2), X(:,3), 'r-', X(:,4), X(:,5), 'g-', X(:,6), X(:,7), 'm-');
xlabel('X Position');
ylabel('Y Position');
title('Trajectories');
legend('P1', 'P2', 'P3', 'P4');
grid on;
axis equal;

% 4. Plot length of the beam over time using BÃ©zier curve length formula
subplot(2, 2, 4);
beam_length = arrayfun(@(i) bezier_length([0 0],[X(i,1), 0], [X(i,2), X(i,3)], [X(i,4), X(i,5)], [X(i,6), X(i,7)]), 1:length(t));
plot(t, beam_length, 'g-');
xlabel('Time');
ylabel('Beam Length');
title('Beam Length Over Time');
grid on;

% Calculate distances between control points
P0 = [0, 0]; % Origin
distances_P0P1 = zeros(length(t), 1);
distances_P1P2 = zeros(length(t), 1);
distances_P2P3 = zeros(length(t), 1);
distances_P3P4 = zeros(length(t), 1);

for i = 1:length(t)
    P1 = [X(i,1), 0];
    P2 = [X(i,2), X(i,3)];
    P3 = [X(i,4), X(i,5)];
    P4 = [X(i,6), X(i,7)];
    
    % Calculate Euclidean distances
    distances_P0P1(i) = norm(P1 - P0);
    distances_P1P2(i) = norm(P2 - P1);
    distances_P2P3(i) = norm(P3 - P2);
    distances_P3P4(i) = norm(P4 - P3);
end

% Create a new figure for distances between control points
figure;
plot(t, distances_P0P1, 'b-', t, distances_P1P2, 'r-', t, distances_P2P3, 'g-', t, distances_P3P4, 'm-');
xlabel('Time');
ylabel('Distance');
title('Distances Between Control Points');
legend('P0-P1', 'P1-P2', 'P2-P3', 'P3-P4');
grid on;

% Calculate energies

%mechanical properties
D = 0.02;
E = 206e5;
I = (pi/64)*D^4;
rho = 1000;
A = (pi*D^2)/4; 
mu = rho*A;
L = 1;
l=L;

function length = bezier_length(P0, P1, P2, P3, P4)
    % Define control point coordinates
    x0 = P0(1); y0 = P0(2);
    x1 = P1(1); y1 = P1(2);
    x2 = P2(1); y2 = P2(2);
    x3 = P3(1); y3 = P3(2);
    x4 = P4(1); y4 = P4(2);

    % Derivatives dx/dt and dy/dt as anonymous functions for quartic bezier
    dxdt = @(t) ...
        4*(1 - t).^3 * (x1 - x0) + ...
        12*(1 - t).^2.*t * (x2 - x1) + ...
        12*(1 - t).*t.^2 * (x3 - x2) + ...
        4*t.^3 * (x4 - x3);

    dydt = @(t) ...
        4*(1 - t).^3 * (y1 - y0) + ...
        12*(1 - t).^2.*t * (y2 - y1) + ...
        12*(1 - t).*t.^2 * (y3 - y2) + ...
        4*t.^3 * (y4 - y3);

    % Arc length integrand
    integrand = @(t) sqrt(dxdt(t).^2 + dydt(t).^2);

    % Numerically integrate from t = 0 to t = 1
    length = integral(integrand, 0, 1);
end

function dXdt = myStateSpace(t, X)
    % Extract variables from the state vector
    x_1 = X(1);
    x_2 = X(2);
    y_2 = X(3);
    x_3 = X(4);
    y_3 = X(5);
    x_4 = X(6);
    y_4 = X(7);
    vx1 = X(8);
    vx2 = X(9);
    vy2 = X(10);
    vx3 = X(11);
    vy3 = X(12);
    vx4 = X(13);
    vy4 = X(14);
    
    %mechanical properties
    D = 0.02;
    E = 206e5;
    I = (pi/64)*D^4;
    rho = 1000;
    A = (pi*D^2)/4; 
    mu = rho*A;
    L = 1;
    l=L;

    %damping coefficient
    c=3.5;

   % Define forces (if F!=0 when calculating equations of motion)
    if t >= 0 && t <= 6
        Fy4 = -0.5; % Force now applied to the 4th control point
    else
        Fy4 = 0;
    end
 
ben1 = @(u) - (2.*((4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2)).*(24.*x_1.*(u - 1).^2 - 12.*x_2.*(u - 1).^2 - 12.*u.^2.*x_2 + 24.*u.^2.*x_3 - 12.*u.^2.*x_4 + 24.*u.*x_3.*(u - 1) + 12.*u.*x_1.*(2.*u - 2) - 24.*u.*x_2.*(2.*u - 2)) - (12.*y_2.*(u - 1).^2 + 12.*u.^2.*y_2 - 24.*u.^2.*y_3 + 12.*u.^2.*y_4 - 24.*u.*y_3.*(u - 1) + 24.*u.*y_2.*(2.*u - 2)).*(4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2))).*((12.*u.*(u - 1).^2 + 4.*(u - 1).^3).*(12.*y_2.*(u - 1).^2 + 12.*u.^2.*y_2 - 24.*u.^2.*y_3 + 12.*u.^2.*y_4 - 24.*u.*y_3.*(u - 1) + 24.*u.*y_2.*(2.*u - 2)) - (12.*u.*(2.*u - 2) + 24.*(u - 1).^2).*(4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2))))./((4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2)).^2 + (4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2)).^2).^3 - (6.*((4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2)).*(24.*x_1.*(u - 1).^2 - 12.*x_2.*(u - 1).^2 - 12.*u.^2.*x_2 + 24.*u.^2.*x_3 - 12.*u.^2.*x_4 + 24.*u.*x_3.*(u - 1) + 12.*u.*x_1.*(2.*u - 2) - 24.*u.*x_2.*(2.*u - 2)) - (12.*y_2.*(u - 1).^2 + 12.*u.^2.*y_2 - 24.*u.^2.*y_3 + 12.*u.^2.*y_4 - 24.*u.*y_3.*(u - 1) + 24.*u.*y_2.*(2.*u - 2)).*(4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2))).^2.*(12.*u.*(u - 1).^2 + 4.*(u - 1).^3).*(4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2)))./((4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2)).^2 + (4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2)).^2).^4;
ben2 = @(u) (6.*((4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2)).*(24.*x_1.*(u - 1).^2 - 12.*x_2.*(u - 1).^2 - 12.*u.^2.*x_2 + 24.*u.^2.*x_3 - 12.*u.^2.*x_4 + 24.*u.*x_3.*(u - 1) + 12.*u.*x_1.*(2.*u - 2) - 24.*u.*x_2.*(2.*u - 2)) - (12.*y_2.*(u - 1).^2 + 12.*u.^2.*y_2 - 24.*u.^2.*y_3 + 12.*u.^2.*y_4 - 24.*u.*y_3.*(u - 1) + 24.*u.*y_2.*(2.*u - 2)).*(4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2))).^2.*(12.*u.*(u - 1).^2 + 6.*u.^2.*(2.*u - 2)).*(4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2)))./((4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2)).^2 + (4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2)).^2).^4 - (2.*((4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2)).*(24.*x_1.*(u - 1).^2 - 12.*x_2.*(u - 1).^2 - 12.*u.^2.*x_2 + 24.*u.^2.*x_3 - 12.*u.^2.*x_4 + 24.*u.*x_3.*(u - 1) + 12.*u.*x_1.*(2.*u - 2) - 24.*u.*x_2.*(2.*u - 2)) - (12.*y_2.*(u - 1).^2 + 12.*u.^2.*y_2 - 24.*u.^2.*y_3 + 12.*u.^2.*y_4 - 24.*u.*y_3.*(u - 1) + 24.*u.*y_2.*(2.*u - 2)).*(4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2))).*((24.*u.*(2.*u - 2) + 12.*(u - 1).^2 + 12.*u.^2).*(4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2)) - (12.*u.*(u - 1).^2 + 6.*u.^2.*(2.*u - 2)).*(12.*y_2.*(u - 1).^2 + 12.*u.^2.*y_2 - 24.*u.^2.*y_3 + 12.*u.^2.*y_4 - 24.*u.*y_3.*(u - 1) + 24.*u.*y_2.*(2.*u - 2))))./((4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2)).^2 + (4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2)).^2).^3;
ben3 = @(u) - (2.*((4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2)).*(24.*x_1.*(u - 1).^2 - 12.*x_2.*(u - 1).^2 - 12.*u.^2.*x_2 + 24.*u.^2.*x_3 - 12.*u.^2.*x_4 + 24.*u.*x_3.*(u - 1) + 12.*u.*x_1.*(2.*u - 2) - 24.*u.*x_2.*(2.*u - 2)) - (12.*y_2.*(u - 1).^2 + 12.*u.^2.*y_2 - 24.*u.^2.*y_3 + 12.*u.^2.*y_4 - 24.*u.*y_3.*(u - 1) + 24.*u.*y_2.*(2.*u - 2)).*(4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2))).*((24.*u.*(2.*u - 2) + 12.*(u - 1).^2 + 12.*u.^2).*(4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2)) - (12.*u.*(u - 1).^2 + 6.*u.^2.*(2.*u - 2)).*(24.*x_1.*(u - 1).^2 - 12.*x_2.*(u - 1).^2 - 12.*u.^2.*x_2 + 24.*u.^2.*x_3 - 12.*u.^2.*x_4 + 24.*u.*x_3.*(u - 1) + 12.*u.*x_1.*(2.*u - 2) - 24.*u.*x_2.*(2.*u - 2))))./((4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2)).^2 + (4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2)).^2).^3 - (6.*((4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2)).*(24.*x_1.*(u - 1).^2 - 12.*x_2.*(u - 1).^2 - 12.*u.^2.*x_2 + 24.*u.^2.*x_3 - 12.*u.^2.*x_4 + 24.*u.*x_3.*(u - 1) + 12.*u.*x_1.*(2.*u - 2) - 24.*u.*x_2.*(2.*u - 2)) - (12.*y_2.*(u - 1).^2 + 12.*u.^2.*y_2 - 24.*u.^2.*y_3 + 12.*u.^2.*y_4 - 24.*u.*y_3.*(u - 1) + 24.*u.*y_2.*(2.*u - 2)).*(4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2))).^2.*(12.*u.*(u - 1).^2 + 6.*u.^2.*(2.*u - 2)).*(4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2)))./((4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2)).^2 + (4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2)).^2).^4;
ben4 = @(u) - (2.*((4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2)).*(24.*x_1.*(u - 1).^2 - 12.*x_2.*(u - 1).^2 - 12.*u.^2.*x_2 + 24.*u.^2.*x_3 - 12.*u.^2.*x_4 + 24.*u.*x_3.*(u - 1) + 12.*u.*x_1.*(2.*u - 2) - 24.*u.*x_2.*(2.*u - 2)) - (12.*y_2.*(u - 1).^2 + 12.*u.^2.*y_2 - 24.*u.^2.*y_3 + 12.*u.^2.*y_4 - 24.*u.*y_3.*(u - 1) + 24.*u.*y_2.*(2.*u - 2)).*(4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2))).*((12.*u.^2.*(u - 1) + 4.*u.^3).*(12.*y_2.*(u - 1).^2 + 12.*u.^2.*y_2 - 24.*u.^2.*y_3 + 12.*u.^2.*y_4 - 24.*u.*y_3.*(u - 1) + 24.*u.*y_2.*(2.*u - 2)) - (24.*u.*(u - 1) + 24.*u.^2).*(4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2))))./((4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2)).^2 + (4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2)).^2).^3 - (6.*((4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2)).*(24.*x_1.*(u - 1).^2 - 12.*x_2.*(u - 1).^2 - 12.*u.^2.*x_2 + 24.*u.^2.*x_3 - 12.*u.^2.*x_4 + 24.*u.*x_3.*(u - 1) + 12.*u.*x_1.*(2.*u - 2) - 24.*u.*x_2.*(2.*u - 2)) - (12.*y_2.*(u - 1).^2 + 12.*u.^2.*y_2 - 24.*u.^2.*y_3 + 12.*u.^2.*y_4 - 24.*u.*y_3.*(u - 1) + 24.*u.*y_2.*(2.*u - 2)).*(4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2))).^2.*(12.*u.^2.*(u - 1) + 4.*u.^3).*(4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2)))./((4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2)).^2 + (4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2)).^2).^4; 
ben5 = @(u) (6.*((4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2)).*(24.*x_1.*(u - 1).^2 - 12.*x_2.*(u - 1).^2 - 12.*u.^2.*x_2 + 24.*u.^2.*x_3 - 12.*u.^2.*x_4 + 24.*u.*x_3.*(u - 1) + 12.*u.*x_1.*(2.*u - 2) - 24.*u.*x_2.*(2.*u - 2)) - (12.*y_2.*(u - 1).^2 + 12.*u.^2.*y_2 - 24.*u.^2.*y_3 + 12.*u.^2.*y_4 - 24.*u.*y_3.*(u - 1) + 24.*u.*y_2.*(2.*u - 2)).*(4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2))).^2.*(12.*u.^2.*(u - 1) + 4.*u.^3).*(4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2)))./((4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2)).^2 + (4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2)).^2).^4 - (2.*((4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2)).*(24.*x_1.*(u - 1).^2 - 12.*x_2.*(u - 1).^2 - 12.*u.^2.*x_2 + 24.*u.^2.*x_3 - 12.*u.^2.*x_4 + 24.*u.*x_3.*(u - 1) + 12.*u.*x_1.*(2.*u - 2) - 24.*u.*x_2.*(2.*u - 2)) - (12.*y_2.*(u - 1).^2 + 12.*u.^2.*y_2 - 24.*u.^2.*y_3 + 12.*u.^2.*y_4 - 24.*u.*y_3.*(u - 1) + 24.*u.*y_2.*(2.*u - 2)).*(4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2))).*((12.*u.^2.*(u - 1) + 4.*u.^3).*(24.*x_1.*(u - 1).^2 - 12.*x_2.*(u - 1).^2 - 12.*u.^2.*x_2 + 24.*u.^2.*x_3 - 12.*u.^2.*x_4 + 24.*u.*x_3.*(u - 1) + 12.*u.*x_1.*(2.*u - 2) - 24.*u.*x_2.*(2.*u - 2)) - (24.*u.*(u - 1) + 24.*u.^2).*(4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2))))./((4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2)).^2 + (4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2)).^2).^3;
ben6 = @(u) (2.*(4.*u.^3.*(12.*y_2.*(u - 1).^2 + 12.*u.^2.*y_2 - 24.*u.^2.*y_3 + 12.*u.^2.*y_4 - 24.*u.*y_3.*(u - 1) + 24.*u.*y_2.*(2.*u - 2)) - 12.*u.^2.*(4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2))).*((4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2)).*(24.*x_1.*(u - 1).^2 - 12.*x_2.*(u - 1).^2 - 12.*u.^2.*x_2 + 24.*u.^2.*x_3 - 12.*u.^2.*x_4 + 24.*u.*x_3.*(u - 1) + 12.*u.*x_1.*(2.*u - 2) - 24.*u.*x_2.*(2.*u - 2)) - (12.*y_2.*(u - 1).^2 + 12.*u.^2.*y_2 - 24.*u.^2.*y_3 + 12.*u.^2.*y_4 - 24.*u.*y_3.*(u - 1) + 24.*u.*y_2.*(2.*u - 2)).*(4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2))))./((4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2)).^2 + (4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2)).^2).^3 + (24.*u.^3.*((4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2)).*(24.*x_1.*(u - 1).^2 - 12.*x_2.*(u - 1).^2 - 12.*u.^2.*x_2 + 24.*u.^2.*x_3 - 12.*u.^2.*x_4 + 24.*u.*x_3.*(u - 1) + 12.*u.*x_1.*(2.*u - 2) - 24.*u.*x_2.*(2.*u - 2)) - (12.*y_2.*(u - 1).^2 + 12.*u.^2.*y_2 - 24.*u.^2.*y_3 + 12.*u.^2.*y_4 - 24.*u.*y_3.*(u - 1) + 24.*u.*y_2.*(2.*u - 2)).*(4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2))).^2.*(4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2)))./((4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2)).^2 + (4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2)).^2).^4;
ben7 = @(u) - (2.*(12.*u.^2.*(4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2)) - 4.*u.^3.*(24.*x_1.*(u - 1).^2 - 12.*x_2.*(u - 1).^2 - 12.*u.^2.*x_2 + 24.*u.^2.*x_3 - 12.*u.^2.*x_4 + 24.*u.*x_3.*(u - 1) + 12.*u.*x_1.*(2.*u - 2) - 24.*u.*x_2.*(2.*u - 2))).*((4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2)).*(24.*x_1.*(u - 1).^2 - 12.*x_2.*(u - 1).^2 - 12.*u.^2.*x_2 + 24.*u.^2.*x_3 - 12.*u.^2.*x_4 + 24.*u.*x_3.*(u - 1) + 12.*u.*x_1.*(2.*u - 2) - 24.*u.*x_2.*(2.*u - 2)) - (12.*y_2.*(u - 1).^2 + 12.*u.^2.*y_2 - 24.*u.^2.*y_3 + 12.*u.^2.*y_4 - 24.*u.*y_3.*(u - 1) + 24.*u.*y_2.*(2.*u - 2)).*(4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2))))./((4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2)).^2 + (4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2)).^2).^3 - (24.*u.^3.*((4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2)).*(24.*x_1.*(u - 1).^2 - 12.*x_2.*(u - 1).^2 - 12.*u.^2.*x_2 + 24.*u.^2.*x_3 - 12.*u.^2.*x_4 + 24.*u.*x_3.*(u - 1) + 12.*u.*x_1.*(2.*u - 2) - 24.*u.*x_2.*(2.*u - 2)) - (12.*y_2.*(u - 1).^2 + 12.*u.^2.*y_2 - 24.*u.^2.*y_3 + 12.*u.^2.*y_4 - 24.*u.*y_3.*(u - 1) + 24.*u.*y_2.*(2.*u - 2)).*(4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2))).^2.*(4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2)))./((4.*x_1.*(u - 1).^3 + 4.*u.^3.*x_3 - 4.*u.^3.*x_4 + 12.*u.*x_1.*(u - 1).^2 - 12.*u.*x_2.*(u - 1).^2 + 12.*u.^2.*x_3.*(u - 1) - 6.*u.^2.*x_2.*(2.*u - 2)).^2 + (4.*u.^3.*y_4 - 4.*u.^3.*y_3 + 12.*u.*y_2.*(u - 1).^2 - 12.*u.^2.*y_3.*(u - 1) + 6.*u.^2.*y_2.*(2.*u - 2)).^2).^4;


str1 = @(u) -(8.*(4.*(u.^2.*(3.*y_2 - 9.*u.*y_2 + 3.*u.*y_3 + 6.*u.^2.*y_2 - 4.*u.^2.*y_3 + u.^2.*y_4).^2 + (x_1 - 6.*u.*x_1 + 3.*u.*x_2 + 9.*u.^2.*x_1 - 9.*u.^2.*x_2 - 4.*u.^3.*x_1 + 3.*u.^2.*x_3 + 6.*u.^3.*x_2 - 4.*u.^3.*x_3 + u.^3.*x_4).^2).^(1./2) - 1).*(4.*u.^3 - 9.*u.^2 + 6.*u - 1).*(x_1 - 6.*u.*x_1 + 3.*u.*x_2 + 9.*u.^2.*x_1 - 9.*u.^2.*x_2 - 4.*u.^3.*x_1 + 3.*u.^2.*x_3 + 6.*u.^3.*x_2 - 4.*u.^3.*x_3 + u.^3.*x_4))./(u.^2.*(3.*y_2 - 9.*u.*y_2 + 3.*u.*y_3 + 6.*u.^2.*y_2 - 4.*u.^2.*y_3 + u.^2.*y_4).^2 + (x_1 - 6.*u.*x_1 + 3.*u.*x_2 + 9.*u.^2.*x_1 - 9.*u.^2.*x_2 - 4.*u.^3.*x_1 + 3.*u.^2.*x_3 + 6.*u.^3.*x_2 - 4.*u.^3.*x_3 + u.^3.*x_4).^2).^(1./2);
str2 = @(u) (8.*(4.*(u.^2.*(3.*y_2 - 9.*u.*y_2 + 3.*u.*y_3 + 6.*u.^2.*y_2 - 4.*u.^2.*y_3 + u.^2.*y_4).^2 + (x_1 - 6.*u.*x_1 + 3.*u.*x_2 + 9.*u.^2.*x_1 - 9.*u.^2.*x_2 - 4.*u.^3.*x_1 + 3.*u.^2.*x_3 + 6.*u.^3.*x_2 - 4.*u.^3.*x_3 + u.^3.*x_4).^2).^(1./2) - 1).*(6.*u.^3 - 9.*u.^2 + 3.*u).*(x_1 - 6.*u.*x_1 + 3.*u.*x_2 + 9.*u.^2.*x_1 - 9.*u.^2.*x_2 - 4.*u.^3.*x_1 + 3.*u.^2.*x_3 + 6.*u.^3.*x_2 - 4.*u.^3.*x_3 + u.^3.*x_4))./(u.^2.*(3.*y_2 - 9.*u.*y_2 + 3.*u.*y_3 + 6.*u.^2.*y_2 - 4.*u.^2.*y_3 + u.^2.*y_4).^2 + (x_1 - 6.*u.*x_1 + 3.*u.*x_2 + 9.*u.^2.*x_1 - 9.*u.^2.*x_2 - 4.*u.^3.*x_1 + 3.*u.^2.*x_3 + 6.*u.^3.*x_2 - 4.*u.^3.*x_3 + u.^3.*x_4).^2).^(1./2);
str3 = @(u) (8.*u.^2.*(4.*(u.^2.*(3.*y_2 - 9.*u.*y_2 + 3.*u.*y_3 + 6.*u.^2.*y_2 - 4.*u.^2.*y_3 + u.^2.*y_4).^2 + (x_1 - 6.*u.*x_1 + 3.*u.*x_2 + 9.*u.^2.*x_1 - 9.*u.^2.*x_2 - 4.*u.^3.*x_1 + 3.*u.^2.*x_3 + 6.*u.^3.*x_2 - 4.*u.^3.*x_3 + u.^3.*x_4).^2).^(1./2) - 1).*(6.*u.^2 - 9.*u + 3).*(3.*y_2 - 9.*u.*y_2 + 3.*u.*y_3 + 6.*u.^2.*y_2 - 4.*u.^2.*y_3 + u.^2.*y_4))./(u.^2.*(3.*y_2 - 9.*u.*y_2 + 3.*u.*y_3 + 6.*u.^2.*y_2 - 4.*u.^2.*y_3 + u.^2.*y_4).^2 + (x_1 - 6.*u.*x_1 + 3.*u.*x_2 + 9.*u.^2.*x_1 - 9.*u.^2.*x_2 - 4.*u.^3.*x_1 + 3.*u.^2.*x_3 + 6.*u.^3.*x_2 - 4.*u.^3.*x_3 + u.^3.*x_4).^2).^(1./2);
str4 = @(u) (8.*(4.*(u.^2.*(3.*y_2 - 9.*u.*y_2 + 3.*u.*y_3 + 6.*u.^2.*y_2 - 4.*u.^2.*y_3 + u.^2.*y_4).^2 + (x_1 - 6.*u.*x_1 + 3.*u.*x_2 + 9.*u.^2.*x_1 - 9.*u.^2.*x_2 - 4.*u.^3.*x_1 + 3.*u.^2.*x_3 + 6.*u.^3.*x_2 - 4.*u.^3.*x_3 + u.^3.*x_4).^2).^(1./2) - 1).*(- 4.*u.^3 + 3.*u.^2).*(x_1 - 6.*u.*x_1 + 3.*u.*x_2 + 9.*u.^2.*x_1 - 9.*u.^2.*x_2 - 4.*u.^3.*x_1 + 3.*u.^2.*x_3 + 6.*u.^3.*x_2 - 4.*u.^3.*x_3 + u.^3.*x_4))./(u.^2.*(3.*y_2 - 9.*u.*y_2 + 3.*u.*y_3 + 6.*u.^2.*y_2 - 4.*u.^2.*y_3 + u.^2.*y_4).^2 + (x_1 - 6.*u.*x_1 + 3.*u.*x_2 + 9.*u.^2.*x_1 - 9.*u.^2.*x_2 - 4.*u.^3.*x_1 + 3.*u.^2.*x_3 + 6.*u.^3.*x_2 - 4.*u.^3.*x_3 + u.^3.*x_4).^2).^(1./2);
str5 = @(u) (8.*u.^2.*(- 4.*u.^2 + 3.*u).*(4.*(u.^2.*(3.*y_2 - 9.*u.*y_2 + 3.*u.*y_3 + 6.*u.^2.*y_2 - 4.*u.^2.*y_3 + u.^2.*y_4).^2 + (x_1 - 6.*u.*x_1 + 3.*u.*x_2 + 9.*u.^2.*x_1 - 9.*u.^2.*x_2 - 4.*u.^3.*x_1 + 3.*u.^2.*x_3 + 6.*u.^3.*x_2 - 4.*u.^3.*x_3 + u.^3.*x_4).^2).^(1./2) - 1).*(3.*y_2 - 9.*u.*y_2 + 3.*u.*y_3 + 6.*u.^2.*y_2 - 4.*u.^2.*y_3 + u.^2.*y_4))./(u.^2.*(3.*y_2 - 9.*u.*y_2 + 3.*u.*y_3 + 6.*u.^2.*y_2 - 4.*u.^2.*y_3 + u.^2.*y_4).^2 + (x_1 - 6.*u.*x_1 + 3.*u.*x_2 + 9.*u.^2.*x_1 - 9.*u.^2.*x_2 - 4.*u.^3.*x_1 + 3.*u.^2.*x_3 + 6.*u.^3.*x_2 - 4.*u.^3.*x_3 + u.^3.*x_4).^2).^(1./2);
str6 = @(u) (8.*u.^3.*(4.*(u.^2.*(3.*y_2 - 9.*u.*y_2 + 3.*u.*y_3 + 6.*u.^2.*y_2 - 4.*u.^2.*y_3 + u.^2.*y_4).^2 + (x_1 - 6.*u.*x_1 + 3.*u.*x_2 + 9.*u.^2.*x_1 - 9.*u.^2.*x_2 - 4.*u.^3.*x_1 + 3.*u.^2.*x_3 + 6.*u.^3.*x_2 - 4.*u.^3.*x_3 + u.^3.*x_4).^2).^(1./2) - 1).*(x_1 - 6.*u.*x_1 + 3.*u.*x_2 + 9.*u.^2.*x_1 - 9.*u.^2.*x_2 - 4.*u.^3.*x_1 + 3.*u.^2.*x_3 + 6.*u.^3.*x_2 - 4.*u.^3.*x_3 + u.^3.*x_4))./(u.^2.*(3.*y_2 - 9.*u.*y_2 + 3.*u.*y_3 + 6.*u.^2.*y_2 - 4.*u.^2.*y_3 + u.^2.*y_4).^2 + (x_1 - 6.*u.*x_1 + 3.*u.*x_2 + 9.*u.^2.*x_1 - 9.*u.^2.*x_2 - 4.*u.^3.*x_1 + 3.*u.^2.*x_3 + 6.*u.^3.*x_2 - 4.*u.^3.*x_3 + u.^3.*x_4).^2).^(1./2);
str7 = @(u) (8.*u.^4.*(4.*(u.^2.*(3.*y_2 - 9.*u.*y_2 + 3.*u.*y_3 + 6.*u.^2.*y_2 - 4.*u.^2.*y_3 + u.^2.*y_4).^2 + (x_1 - 6.*u.*x_1 + 3.*u.*x_2 + 9.*u.^2.*x_1 - 9.*u.^2.*x_2 - 4.*u.^3.*x_1 + 3.*u.^2.*x_3 + 6.*u.^3.*x_2 - 4.*u.^3.*x_3 + u.^3.*x_4).^2).^(1./2) - 1).*(3.*y_2 - 9.*u.*y_2 + 3.*u.*y_3 + 6.*u.^2.*y_2 - 4.*u.^2.*y_3 + u.^2.*y_4))./(u.^2.*(3.*y_2 - 9.*u.*y_2 + 3.*u.*y_3 + 6.*u.^2.*y_2 - 4.*u.^2.*y_3 + u.^2.*y_4).^2 + (x_1 - 6.*u.*x_1 + 3.*u.*x_2 + 9.*u.^2.*x_1 - 9.*u.^2.*x_2 - 4.*u.^3.*x_1 + 3.*u.^2.*x_3 + 6.*u.^3.*x_2 - 4.*u.^3.*x_3 + u.^3.*x_4).^2).^(1./2);

% Using Gaussian quadrature instead of integral function
Qben1 = (-1/2)*E*I*L*gauss_quad(ben1, 0, 1);
Qben2 = (-1/2)*E*I*L*gauss_quad(ben2, 0, 1);
Qben3 = (-1/2)*E*I*L*gauss_quad(ben3, 0, 1);
Qben4 = (-1/2)*E*I*L*gauss_quad(ben4, 0, 1);
Qben5 = (-1/2)*E*I*L*gauss_quad(ben5, 0, 1);
Qben6 = (-1/2)*E*I*L*gauss_quad(ben6, 0, 1);
Qben7 = (-1/2)*E*I*L*gauss_quad(ben7, 0, 1);

Qstr1 = (-1/2) * E * A * L * gauss_quad(str1, 0, 1);
Qstr2 = (-1/2) * E * A * L * gauss_quad(str2, 0, 1);
Qstr3 = (-1/2) * E * A * L * gauss_quad(str3, 0, 1);
Qstr4 = (-1/2) * E * A * L * gauss_quad(str4, 0, 1);
Qstr5 = (-1/2) * E * A * L * gauss_quad(str5, 0, 1);
Qstr6 = (-1/2) * E * A * L * gauss_quad(str6, 0, 1);
Qstr7 = (-1/2) * E * A * L * gauss_quad(str7, 0, 1);


      % dynamics
    x_dotdot1 =(15*(10*Qben1 - 15*Qben2 + 9*Qben4 - 2*Qben6 + 10*Qstr1 - 15*Qstr2 + 9*Qstr4 - 2*Qstr6))/(2*l*mu);

    x_dotdot2 =-(5*(45*Qben1 - 92*Qben2 + 65*Qben4 - 16*Qben6 + 45*Qstr1 - 92*Qstr2 + 65*Qstr4 - 16*Qstr6))/(2*l*mu) ;

    y_dotdot2 = ((35*(2*Fy4 + 7*Qben3 - 7*Qben5 + 2*Qben7 + 7*Qstr3 - 7*Qstr5 + 2*Qstr7))/(4*l*mu) )-c*vy2;

    x_dotdot3 = (5*(27*Qben1 - 65*Qben2 + 60*Qben4 - 18*Qben6 + 27*Qstr1 - 65*Qstr2 + 60*Qstr4 - 18*Qstr6))/(2*l*mu);

    y_dotdot3 = (-(7*(18*Fy4 + 35*Qben3 - 51*Qben5 + 18*Qben7 + 35*Qstr3 - 51*Qstr5 + 18*Qstr7))/(4*l*mu)) -c*vy3 ;

    x_dotdot4 = -(15*Qben1 - 40*Qben2 + 45*Qben4 - 24*Qben6 + 15*Qstr1 - 40*Qstr2 + 45*Qstr4 - 24*Qstr6)/(l*mu); 
    y_dotdot4 = ((7*(6*Fy4 + 5*Qben3 - 9*Qben5 + 6*Qben7 + 5*Qstr3 - 9*Qstr5 + 6*Qstr7))/(2*l*mu)) -c*vy4; 

    % Assemble the derivative of the state vector
    dXdt = zeros(14,1);
    dXdt(1) = vx1;
    dXdt(2) = vx2;
    dXdt(3) = vy2;
    dXdt(4) = vx3;
    dXdt(5) = vy3;
    dXdt(6) = vx4;
    dXdt(7) = vy4;
    
    % The next components are the accelerations:
    dXdt(8) = x_dotdot1;
    dXdt(9) = x_dotdot2;
    dXdt(10) = y_dotdot2;
    dXdt(11) = x_dotdot3;
    dXdt(12) = y_dotdot3;
    dXdt(13) = x_dotdot4;
    dXdt(14) = y_dotdot4;
end

% Helper function for Gaussian quadrature 
function result = gauss_quad(func, a, b)
    % 7-point Gaussian quadrature for better accuracy
    % Points and weights for the standard interval [-1, 1]
    x = [-0.9491079123427585, -0.7415311855993945, -0.4058451513773972, ...
         0.0000000000000000, ...
         0.4058451513773972, 0.7415311855993945, 0.9491079123427585];
    
    w = [0.1294849661688697, 0.2797053914892766, 0.3818300505051189, ...
         0.4179591836734694, ...
         0.3818300505051189, 0.2797053914892766, 0.1294849661688697];
    
    % Transform to [a, b]
    x = 0.5*((b-a)*x + (b+a));
    w = 0.5*(b-a)*w;
    
    % Compute weighted sum
    result = 0;
    for i = 1:length(x)
        result = result + w(i) * func(x(i));
    end
end